---
title: 3.0 版本变更
icon: CircleFadingArrowUp
---

这次更新是一次彻底的底层重构，旨在用一个成熟的渲染库（Pixi.js）替换掉旧的自定义实现，以期获得更好的性能和可维护性。因此，几乎所有与渲染、用户交互、舞台对象管理相关的旧代码和 API 都已失效或被替换。任何基于旧版本进行开发的功能都需要根据新的架构进行完全重写。

## 重要的操作方式变更和新功能

### Section 从实体变为关系

在以前的版本中，Section 属于实体。而在 3.0 版本中，Section 被重新定义为实体之间的关系。这意味着 Section 必须包含至少一个实体，不能单独放置在舞台上。

## 不重要的新功能和改进

### URL 节点支持 OpenGraph 协议

我们部署了一个公益服务 [url-meta.graphif.dev](https://url-meta.graphif.dev/)，用于从 URL 中提取 Open Graph 数据

### 最小窗口大小限制为 1200x800

在以前的版本中，当窗口大小比例满足以下条件时，标签页栏会显示到菜单栏的下面：

$$
\frac{w}{h} \leq \frac{9}{5}
$$

由于代码较为复杂，新版本中移除了此逻辑，标签页栏始终显示在菜单栏的右侧。为了确保良好的用户体验，最小窗口大小被限制为 1200x800。

## 技术相关变更

### 从 Canvas 2D 迁移到 Pixi.js 渲染引擎

这是最核心的破坏性变更。整个项目已经从一个基于原生 Canvas 2D API 的自定义渲染引擎迁移到了使用 Pixi.js 库。

- 大量代码删除: 整个 `app/src/core/render/` 目录被删除，包括 `Renderer`, `Canvas` 等服务。
- 引入新依赖: 引入了 `pixi.js` 及其生态，如 `@pixi/viewport`, `@pixi/layout` 等。

任何依赖于旧渲染器的代码都将完全失效。

### `Project` 类接口变更

- 不允许动态加载服务: `Project` 实例将不允许在运行时动态加载服务，所有服务必须在调用 `project.init()` 时一次性传入。
- 移除主循环控制方法: `project.loop()`, `project.pause()`, `project.tick()` 等方法被移除，主循环现在由 Pixi.js 管理。

### 舞台对象继承体系重构

得益于 Pixi.js 强大的 Scene Objects 体系，`StageObject` 现在直接继承自 `@pixi/layout` 中的 `LayoutContainer` 类，由 Pixi.js 负责布局、渲染、交互等。

- 舞台对象选中时的边框高亮效果现在由 `StageObject` 统一渲染。
- 实体的移动逻辑现在由 `Entity` 统一实现。
